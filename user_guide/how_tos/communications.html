
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Communications &#8212; UPSTAGE 0.4.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=6c02275b"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/how_tos/communications';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Typing and UPSTAGE" href="typing.html" />
    <link rel="prev" title="Motion Manager" href="motion_manager.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/upstage-logo-medium.png" class="logo__image only-light" alt=""/>
    <img src="../../_static/upstage-logo-medium.png" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">UPSTAGE</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../demo.html">
    Demo
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../auto/modules.html">
    upstage_des
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/gtri/upstage/" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../demo.html">
    Demo
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../auto/modules.html">
    upstage_des
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/gtri/upstage/" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../tutorials/first_simulation.html">First UPSTAGE Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/interrupts.html">Task Interrupts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/rehearsal.html">Task Rehearsal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/best_practices.html">Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/data.html">Simulation Data Gathering and Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/simpy_compare.html">UPSTAGE vs SimPy</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Full Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../tutorials/first_sim_full.html">First Simulation Full Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/rehearsal_sim.html">Rehearsal Simulation Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/complex_cashier.html">Complex Cashier Full Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/data_creation_example.html">Data Gathering Example Full Source</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">How-Tos</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="environment.html">Environment Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="states.html">States</a></li>
<li class="toctree-l1"><a class="reference internal" href="keyvalue_states.html">Key/Value States</a></li>
<li class="toctree-l1"><a class="reference internal" href="multistore_states.html">Key/Value Resource State</a></li>
<li class="toctree-l1"><a class="reference internal" href="knowledge.html">Knowledge</a></li>
<li class="toctree-l1"><a class="reference internal" href="task.html">Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Resource Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="resource_states.html">Resource States</a></li>
<li class="toctree-l1"><a class="reference internal" href="active_states.html">Active States</a></li>
<li class="toctree-l1"><a class="reference internal" href="mimic_states.html">Mimic States</a></li>
<li class="toctree-l1"><a class="reference internal" href="nucleus.html">Task Nucleus</a></li>
<li class="toctree-l1"><a class="reference internal" href="stage_variables.html">Stage Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="times.html">Time Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="events.html">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="geography.html">Geography</a></li>
<li class="toctree-l1"><a class="reference internal" href="decision_tasks.html">Decision Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="task_networks.html">Task Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="state_sharing.html">State Sharing</a></li>
<li class="toctree-l1"><a class="reference internal" href="entity_naming.html">Named Entities</a></li>
<li class="toctree-l1"><a class="reference internal" href="motion_manager.html">Motion Manager</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Communications</a></li>
<li class="toctree-l1"><a class="reference internal" href="typing.html">Typing and UPSTAGE</a></li>
<li class="toctree-l1"><a class="reference internal" href="random_numbers.html">Random Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="routines.html">Routines</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Communications</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="communications">
<h1>Communications<a class="headerlink" href="#communications" title="Link to this heading">#</a></h1>
<p>UPSTAGE provides a built-in classes for passing communications between actors.
There is point-to-point communication which is highly simplified and flexible
for message-passing when you want to abstract away any routing or other concerns.
There is also a communications manager based on routing tables that allows pre-
defined routing to be followed. That same manager is subclassable for more
complicated routing schemes and behaviors.</p>
<section id="point-to-point-communications">
<h2>Point to Point Communications<a class="headerlink" href="#point-to-point-communications" title="Link to this heading">#</a></h2>
<p>The <a class="reference internal" href="../../auto/upstage_des.communications.html#upstage_des.communications.comms.PointToPointCommsManager" title="upstage_des.communications.comms.PointToPointCommsManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">PointToPointCommsManager</span></code></a> class
allows actors to send messages while allowing for simplified retry attempts
and timeouts. It also allows for communications blocking to be turned on
and off on a point to point basis.</p>
<p>The <a class="reference internal" href="../../auto/upstage_des.communications.html#upstage_des.communications.comms.Message" title="upstage_des.communications.comms.Message"><code class="xref py py-class docutils literal notranslate"><span class="pre">Message</span></code></a> class is used to
describe a message, although strings and dictionaries can also be passed as
messages, and UPSTAGE will convert them into the <code class="docutils literal notranslate"><span class="pre">Message</span></code> class. The
message will include information about the sender, mode, and other data.</p>
<p>The communications manager needs to be instantiated and run, and any number
of them can be run to represent different modes of communication. For
simplicity, communications stores on an actor can have multiple modes
to receive communications on. Each mode needs its own manager which can
then determine the right store to send the message to.</p>
<p>The following code shows how create an actor class that has two communication
interfaces, and then start the necessary comms managers.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">upstage_des.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">UP</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Worker</span><span class="p">(</span><span class="n">UP</span><span class="o">.</span><span class="n">Actor</span><span class="p">):</span>
    <span class="n">walkie</span> <span class="o">=</span> <span class="n">UP</span><span class="o">.</span><span class="n">CommunicationStore</span><span class="p">(</span><span class="n">modes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;UHF&quot;</span><span class="p">])</span>
    <span class="n">intercom</span> <span class="o">=</span> <span class="n">UP</span><span class="o">.</span><span class="n">CommunicationStore</span><span class="p">(</span><span class="n">modes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;loudspeaker&quot;</span><span class="p">])</span>


<span class="k">with</span> <span class="n">UP</span><span class="o">.</span><span class="n">EnvironmentContext</span><span class="p">()</span> <span class="k">as</span> <span class="n">env</span><span class="p">:</span>
    <span class="n">w1</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;worker1&quot;</span><span class="p">)</span>
    <span class="n">w2</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;worker2&quot;</span><span class="p">)</span>

    <span class="n">uhf_comms</span> <span class="o">=</span> <span class="n">PointToPointCommsManager</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Walkies&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;UHF&quot;</span><span class="p">)</span>
    <span class="n">loudspeaker_comms</span> <span class="o">=</span> <span class="n">PointToPointCommsManager</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Overhead&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;loudspeaker&quot;</span><span class="p">)</span>

    <span class="n">UP</span><span class="o">.</span><span class="n">add_stage_variable</span><span class="p">(</span><span class="s2">&quot;uhf&quot;</span><span class="p">,</span> <span class="n">uhf_comms</span><span class="p">)</span>
    <span class="n">UP</span><span class="o">.</span><span class="n">add_stage_variable</span><span class="p">(</span><span class="s2">&quot;loudspeaker&quot;</span><span class="p">,</span> <span class="n">loudspeaker_comms</span><span class="p">)</span>

    <span class="n">uhf_comms</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">loudspeaker_comms</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">PointToPointCommsManager</span></code> class allows for explicitly connecting actors and the
store that will receive messages, but using the <a class="reference internal" href="../../auto/upstage_des.html#upstage_des.states.CommunicationStore" title="upstage_des.states.CommunicationStore"><code class="xref py py-class docutils literal notranslate"><span class="pre">CommunicationStore</span></code></a>
lets the manager auto-discover the proper store for a communications mode,
letting the simulation designer only need to pass the source actor, destination
actor, and message information to the manager.</p>
<p>To send a message, use the comm manager’s <code class="docutils literal notranslate"><span class="pre">make_put</span></code> method to return an UPSTAGE
event to yield on to send the message.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Talk</span><span class="p">(</span><span class="n">UP</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">actor</span><span class="p">:</span> <span class="n">Worker</span><span class="p">):</span>
        <span class="n">uhf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">uhf</span>
        <span class="n">friend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_actor_knowledge</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="s2">&quot;friend&quot;</span><span class="p">,</span> <span class="n">must_exist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">msg_evt</span> <span class="o">=</span> <span class="n">uhf</span><span class="o">.</span><span class="n">make_put</span><span class="p">(</span><span class="s2">&quot;Hello worker&quot;</span><span class="p">,</span> <span class="n">actor</span><span class="p">,</span> <span class="n">friend</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">msg_evt</span>


<span class="k">class</span><span class="w"> </span><span class="nc">GetMessage</span><span class="p">(</span><span class="n">UP</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">actor</span><span class="p">:</span> <span class="n">Worker</span><span class="p">):</span>
        <span class="n">get_uhf</span> <span class="o">=</span> <span class="n">UP</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">walkie</span><span class="p">)</span>
        <span class="n">get_loud</span> <span class="o">=</span> <span class="n">UP</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">loudspeaker</span><span class="p">)</span>

        <span class="k">yield</span> <span class="n">UP</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="n">get_uhf</span><span class="p">,</span> <span class="n">get_loud</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">get_uhf</span><span class="o">.</span><span class="n">is_complete</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">get_uhf</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2"> sent &#39;</span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&#39; at </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">time_sent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">get_uhf</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
        <span class="o">...</span>
</pre></div>
</div>
<section id="stopping-communications">
<h3>Stopping Communications<a class="headerlink" href="#stopping-communications" title="Link to this heading">#</a></h3>
<p>Communications can be halted for all transmissions of a single manager by setting
<code class="docutils literal notranslate"><span class="pre">comms_degraded</span></code> to be <code class="docutils literal notranslate"><span class="pre">True</span></code> at any time. Setting it back to False will allow
comms to pass again, and any retries that are waiting (and didn’t exceed a timeout)
will go through.</p>
<p>Additionally, specific links can be stopped by adding/removing from <code class="docutils literal notranslate"><span class="pre">blocked_links</span></code>
with a tuple of <code class="docutils literal notranslate"><span class="pre">(sender_actor,</span> <span class="pre">destination_actor)</span></code> links to shut down. The same
timeout rules will apply. There is a <code class="docutils literal notranslate"><span class="pre">blocked_nodes</span></code> list that can have single
<code class="docutils literal notranslate"><span class="pre">Actors</span></code> added to it if you want to block all paths to and from that actor rather
than just one link.</p>
</section>
</section>
<section id="routing-table-communications">
<h2>Routing Table Communications<a class="headerlink" href="#routing-table-communications" title="Link to this heading">#</a></h2>
<p>UPSTAGE has a <a class="reference internal" href="../../auto/upstage_des.communications.html#upstage_des.communications.routing.RoutingTableCommsManager" title="upstage_des.communications.routing.RoutingTableCommsManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">RoutingTableCommsManager</span></code></a> that
routes comms according to a pre-defined network. Nodes (which are <code class="docutils literal notranslate"><span class="pre">Actors</span></code>) must be
explicitly connected, and this manager will route through shortest number of hops.</p>
<p>An example creation of the manager is given below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">CommNode</span><span class="p">(</span><span class="n">Actor</span><span class="p">):</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="n">CommunicationStore</span><span class="p">(</span><span class="n">modes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="k">with</span> <span class="n">EnvironmentContext</span><span class="p">()</span> <span class="k">as</span> <span class="n">env</span><span class="p">:</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">CommNode</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;modes&quot;</span><span class="p">:[</span><span class="s2">&quot;cup-and-string&quot;</span><span class="p">]})</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="s2">&quot;ABCDEFGH&quot;</span>
    <span class="p">}</span>
    <span class="n">mgr</span> <span class="o">=</span> <span class="n">RoutingTableCommsManager</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;StaticManager&quot;</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;cup-and-string&quot;</span><span class="p">,</span>
        <span class="n">send_time</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mf">3600.</span><span class="p">,</span>
        <span class="n">retry_max_time</span><span class="o">=</span><span class="mi">20</span><span class="o">/</span><span class="mf">3600.</span><span class="p">,</span>
        <span class="n">retry_rate</span><span class="o">=</span><span class="mi">4</span><span class="o">/</span><span class="mf">3600.</span><span class="p">,</span>
        <span class="n">global_ignore</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;AB&quot;</span><span class="p">,</span> <span class="s2">&quot;BC&quot;</span><span class="p">,</span> <span class="s2">&quot;AD&quot;</span><span class="p">,</span> <span class="s2">&quot;DE&quot;</span><span class="p">,</span> <span class="s2">&quot;EF&quot;</span><span class="p">,</span> <span class="s2">&quot;FG&quot;</span><span class="p">,</span> <span class="s2">&quot;GH&quot;</span><span class="p">,</span> <span class="s2">&quot;HC&quot;</span><span class="p">,</span> <span class="s2">&quot;EB&quot;</span><span class="p">]:</span>
        <span class="n">mgr</span><span class="o">.</span><span class="n">connect_nodes</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">two_way</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Note how this manager uses <code class="docutils literal notranslate"><span class="pre">connect_nodes()</span></code> to define explicit edges in the
routing graph. You can optionally set <code class="docutils literal notranslate"><span class="pre">two_way</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code> if you want the
edge to go back and forth.</p>
<p>The manager is still invoked the same by any actor wanting to send a message.
Use <code class="docutils literal notranslate"><span class="pre">make_put</span></code> and yield on the returned event to put the message into the
network.</p>
<p>The reason this is called a routing table method, even though it uses a graph,
is because the underlying <code class="docutils literal notranslate"><span class="pre">select_hop</span></code> method only tells the current node
where to send the message once. Once the message is passed along, it’ll re-check
what node to go to next.</p>
<p>This manager allows for degraded comms and comms retry like the point-to-point manager.
If a link is degraded, after the retry fails the network will re-plan a
route assuming the intermediate destination node is no longer available.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Message routing does not depend on the Actors used for routing. No messages
are sent to the stores on the Actors connected, and the actors do not need
tasks or processes to handle message routing. The routing manager moves
the messages in time only until it reaches the desired destination.</p>
</div>
<p>The behavior is:</p>
<ol class="arabic simple">
<li><p>Ask for transmit from SOURCE to DEST</p></li>
<li><p>Set CURRENT to SOURCE</p></li>
<li><p>Find the NEXT in the shortest path from CURRENT to DEST</p></li>
<li><p>If there is no path, stop trying to send and end.</p></li>
<li><p>Attempt to send to NEXT (this is the degraded comms/retry step)</p></li>
<li><p>If it can send, do so. Set CURRENT = NEXT. If NEXT is DEST, Goto 8. Otherwise, Goto 3.</p></li>
<li><p>If it can’t send, drop NEXT from the route options. Goto 3</p></li>
<li><p>Place message in DEST and end.</p></li>
</ol>
<p>Since this is time-based, a link can re-open during transmission. If the
network has paths:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">-&gt;</span> <span class="n">B</span> <span class="o">-&gt;</span> <span class="n">C</span>
<span class="n">A</span> <span class="o">-&gt;</span> <span class="n">D</span> <span class="o">-&gt;</span> <span class="n">E</span> <span class="o">-&gt;</span> <span class="n">F</span> <span class="o">-&gt;</span> <span class="n">G</span> <span class="o">-&gt;</span> <span class="n">H</span> <span class="o">-&gt;</span> <span class="n">C</span>
<span class="n">E</span> <span class="o">-&gt;</span> <span class="n">B</span> <span class="o">-&gt;</span> <span class="n">C</span>
</pre></div>
</div>
<p>and we want to send a message from A to C, but B is blocked, a retry will have the
network eventually take the long way through ADEFGHC. If B comes back online
after the message gets to E, the routing will choose ADEBC instead.</p>
<p>If B does not come back online, the router will still try to go to B from E
since that is shorter. If B is still down, it will take longer due to the
retry. Set the input <code class="docutils literal notranslate"><span class="pre">global_ignore</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code> to ignore a bad node
for the entire routing and avoid this behavior.</p>
<section id="id1">
<h3>Stopping Communications<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>The same two options for stopping a message link exist for this manager. The
<code class="docutils literal notranslate"><span class="pre">blocked_links</span></code> list and the <code class="docutils literal notranslate"><span class="pre">blocked_nodes</span></code> list on the manager can be
updated to prevent comms along a link or to/from a specific node. Note that
if <code class="docutils literal notranslate"><span class="pre">global_ignore</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> that a blocked link will result in effectively
blocking any comms to the destination node even if you intended only one link
to go down.</p>
</section>
<section id="routing-with-multiple-modes">
<h3>Routing With Multiple Modes<a class="headerlink" href="#routing-with-multiple-modes" title="Link to this heading">#</a></h3>
<p>The routing table manager does not allow for hops across different nodes, even
if in practice you could radio someone and that person makes an announcement on
an intercom. This may become a future feature of UPSTAGE. For now, see the section
below for how to make your own router.</p>
</section>
</section>
<section id="make-your-own">
<h2>Make Your Own<a class="headerlink" href="#make-your-own" title="Link to this heading">#</a></h2>
<p>The intent of the <a class="reference internal" href="../../auto/upstage_des.communications.html#upstage_des.communications.routing.RoutingTableCommsManager" title="upstage_des.communications.routing.RoutingTableCommsManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">RoutingTableCommsManager</span></code></a> class
is to provide an example of a more dynamic comms routing feature. It is based on the
<a class="reference internal" href="../../auto/upstage_des.communications.html#upstage_des.communications.routing.RoutingCommsManagerBase" title="upstage_des.communications.routing.RoutingCommsManagerBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">RoutingCommsManagerBase</span></code></a> class, which holds most
of the work the manager does. This includes managing retries and the behavior steps described
above. The <code class="docutils literal notranslate"><span class="pre">RoutingTableCommsManager</span></code> only implements enough features to build, store, and
call the network to determine the next hop.</p>
<p>To make your own, you only have to implement the <code class="docutils literal notranslate"><span class="pre">select_hop</span></code> method, which returns the next
actor to send a message to. Currently, there are not placeholders in the base class for
running other processes (such as acknowledgment, network discovery, etc.) on failures in the
built-in message transmission process. Acknowledgment is implied through the retry features,
but anything more advanced is not built-in.</p>
<p>It is possible to create a network discovery protocol in effect by creating a process that
determines which links should exist at a given time step. Then, as long as the data structure
you modify there is used in <code class="docutils literal notranslate"><span class="pre">select_hop</span></code>, you can have more complicated network behaviors
approximated without large amounts of explicit message passing.</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="motion_manager.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Motion Manager</p>
      </div>
    </a>
    <a class="right-next"
       href="typing.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Typing and UPSTAGE</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#point-to-point-communications">Point to Point Communications</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stopping-communications">Stopping Communications</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#routing-table-communications">Routing Table Communications</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Stopping Communications</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#routing-with-multiple-modes">Routing With Multiple Modes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#make-your-own">Make Your Own</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, UPSTAGE Contributors, GTRI.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>